$(function(){function t(){g="https://csdnimg.cn/release/download/images/pay_error.png",f="已扫码<br>请在手机端操作",$("#payCode").html('<div class="renovate"><img src="'+g+'"><span>'+f+"</span></div>"),$("#payCodeImg").html('<img class="repeat-again" src="'+g+'"><span class="text">'+f+"</span>")}function e(e){var c={goods_id:e,flag:17,request_type:4,success_function:a,error_function:o,timeout_function:i,get_pay_success_callback:n,is_use_balance:p,payment_function:t};$("#payCode").html(x),$("#payCodeImg").html(h),console.log(p),cart.qrPay(c)}function a(t,e){b?r("payCode",e.pay_url):r("payCodeImg",e.pay_url)}function n(){m.boxshadow.fadeOut(function(){showToast({text:"支付成功",bottom:"10%",zindex:9e3,speed:500,time:1500}),window.location.reload(),m.payCode.fadeOut(function(){window.location.reload()})})}function o(t){showToast({text:t.errorMessage,bottom:"10%",zindex:9e3,speed:500,time:1500})}function i(){b?m.payCode.find("#payCode").html(w):m.getPay.find("#payCodeImg").html(k)}function c(t){switch(t){case"column":p?s(C,l)>0?$(".now-price").text("¥"+s(C,l)):$(".now-price").text("¥0"):$(".now-price").text("¥"+C);break;case"details":var e=$(".pay-money-span").attr("data-oldprice");p?s(e,l)>0?$(".pay-money-span").text(s(e,l)+"元"):$(".pay-money-span").text("0元"):$(".pay-money-span").text($(".pay-money-span").attr("data-oldprice")+"元")}}function s(t,e){var a=Number(t)-Number(e);return a>0?a.toFixed(2):a<0?a.toFixed(2):a}function d(t,a){$.ajax({type:"GET",url:"https://order.csdn.net/api/app/v1/getBalance",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){l=n.data.balance,_++,_<=1&&(0==l?(p=0,$(".pay-code-radio").prop("disabled",!0)):(p=1,$(".pay-code-radio").attr("checked",!0))),$(".pay-balance .balance").text(l),$(".pay-code-balance .balance").text(l),c(a),e(t)}})}function r(t,e){var a=qrcode(6,"M");a.addData(e),a.make(),$("#"+t).html(a.createImgTag(3,3)),$("#"+t).html($("#"+t).html()),b&&m.boxshadow.fadeIn(function(){m.payCode.fadeIn()})}var p=0,l=0;$(document).on("click",".tip-subscribe-column>span",function(){$(this).parent().find(".tip").fadeIn()}),$(document).on("click",".tip-subscribe-column .bt-close",function(){$(".tip-subscribe-column").find(".tip").fadeOut()});var u="",m={boxshadow:$(".skin-boxshadow"),btClose:$(".bt-close"),payCode:$(".pay-code"),btSubscribe:$(".bt-subscribe-article"),btSubscribeColumn:$(".bt-subscribe-text"),getPay:$(".get-pay")},b=!1,y=window.location.href;y.indexOf("category_")>-1&&!b&&getCookie("UserName")&&m.btSubscribeColumn.length&&(u=m.getPay.data("id"),d(m.getPay.data("id"),"column")),$(document).on("click",".bt-subscribe",function(){getCookie("UserName")||window.csdn.loginBox.show()}),m.getPay.on("click",function(){b=!1,u=$(this).data("id"),e(u)}),$(document).on("click",".bt-subscribe-article",function(){b=!0,$(".pay-money-span").text($(".pay-money-span").data("nowprice")),getCookie("UserName")?(u=$(this).data("id"),d(u,"details")):window.csdn.loginBox.show()}),$(document).on("click","#bt-click",function(){b=!0,getCookie("UserName")?(u=$(this).data("id"),d(u,"details")):window.csdn.loginBox.show()}),m.payCode.on("click",".renovate",function(){e(u||$(this).parent().data("id"))}),m.btClose.on("click",function(){m.payCode.fadeOut(function(){m.boxshadow.fadeOut()})});var g="/static_files/static_blog/images/pay-time-out.png",f="获取中",h='<img class="repeat-again" src="'+g+'"><span class="text">'+f+"</span>",x='<div class="renov-men"><img src="'+g+'"><span>'+f+"</span></div>",w='<div class="renovate">    <img src="'+blogUrl+'static_files/static_blog/images/pay-time-out.png">    <span>点击重新获取</span></div>',k='<img class="repeat-again" src="'+blogUrl+'static_files/static_blog/images/pay-time-out.png"><span class="text">点击重新获取</span>';$(".now-price").text();$(".pay-code-radio").click(function(){var t=$(this).attr("name"),e=$(this).attr("checked");$("input:radio[name='"+t+"']").attr("checked",!1),$(this).attr("checked",!0),p=1,"checked"==e&&(p=0,$(this).attr("checked",!1)),d(u,$(this).attr("data-type"))});var C=$(".subscribe-price .now-price").text().slice(1),_=0});